/** *dianping.com Inc *Copyright(c)2004-2016 All Rights Reserved. */package com.dianping.event.dao;import com.dianping.event.entity.DailyReportInfo;import com.dianping.event.entity.ReportAggregationStateTracker;import com.dianping.event.servcie.StateCheckService;import javax.annotation.Resource;import java.util.Date;import java.util.HashMap;import java.util.Map;/** * @author zhangjie * @version $Id: EventStorage.java, v 0.1 2016-04-11 下午3:56 zhangjie Exp $$ */public class EventStorage {    private static final Map<Integer, ReportAggregationStateTracker> trackerStorage = new HashMap<Integer, ReportAggregationStateTracker>();    @Resource    private StateCheckService stateCheckService;    /**     * 通过ID查找tracker     *     * @param shopAccountId     * @return     */    public ReportAggregationStateTracker ofId(int shopAccountId) {        if (trackerStorage.containsKey(shopAccountId)) {            return trackerStorage.get(shopAccountId);        }        return null;    }    /**     * 新建一个tracker     *     * @param shopAccountId     */    public ReportAggregationStateTracker newTracker(int shopAccountId) {        ReportAggregationStateTracker tracker = new ReportAggregationStateTracker();        tracker.setShopAccountId(shopAccountId);        tracker.setStartTime(new Date());        tracker.setComplete(false);        tracker.setHasTimeOut(false);        return tracker;    }    /**     * 将新收到的事件中的信息append到tracker中     *     * @param shopAccountId     * @param info     * @return     */    public ReportAggregationStateTracker appendDailyReport(int shopAccountId, DailyReportInfo info) {        ReportAggregationStateTracker tracker = ofId(shopAccountId);        tracker.append(info);        stateCheckService.checkComplete(tracker);        return tracker;    }}